<div class="page">
    <h1>Debugging Exercise Generator</h1>
    
    <!--Could be put in own component or dropdown-->
    <div class="program-details-pane">
        <h2>Program Details</h2>
        <!--Form here-->
        <div>
            <form [formGroup]="programDetailsForm" class="program-details-form" (ngSubmit)="generateExercise()">
                <h4>Program Description</h4>
                <mat-form-field>
                    <mat-label>Program Description</mat-label>
                    <textarea matInput id="program-description" type="text" formControlName="programDescription" required></textarea>
                </mat-form-field>

                <h4>Correct Program</h4>
                <mat-form-field>
                    <!--Ideally have CM component here-->
                    <mat-label>Correct Program</mat-label>
                    <textarea matInput id="correct-program" type="text" formControlName="correctProgram" required></textarea>
                </mat-form-field>

                <mat-form-field>
                    <mat-label>Number of syntax errors</mat-label>
                    <mat-select matNativeControl formControlName="numberSyntaxErrors" required>
                        <mat-option *ngFor="let i of [0,1,2,3]" value="{{i}}">{{i}}</mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-form-field>
                    <mat-label>Number of runtime errors</mat-label>
                    <mat-select matNativeControl formControlName="numberRuntimeErrors" required>
                        <mat-option *ngFor="let i of [0,1,2,3]" value="{{i}}">{{i}}</mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-form-field>
                    <mat-label>Number of logical errors</mat-label>
                    <mat-select matNativeControl formControlName="numberLogicalErrors" required>
                        <mat-option *ngFor="let i of [0,1,2,3]" value="{{i}}">{{i}}</mat-option>
                    </mat-select>
                </mat-form-field>

                <button mat-flat-button *ngIf="!exerciseGenerated" type="submit" color="primary" [disabled]="!programDetailsForm.valid || loading">{{loading ? "Generating Exercise" : exerciseGenerated ? "Regenerate Exercise(X remaining)" : "Generate Exercise"}}</button>
                <!--<button mat-flat-button *ngIf="exerciseGenerated" type="submit" color="primary" [disabled]="!programDetailsForm.valid || loading">Regenerate Exercise ({{remainingRegenerations}} remaining)</button>-->

            </form>
        </div>
    </div>

    <div *ngIf="loading" class="generated-program-pane">
        <h1>Loading...</h1>
    </div>

    <div *ngIf="exerciseGenerated" class="generated-program-pane">
        <!--Have link so teachers can share with students; make unique webpage to include-->
        <h2>Generated Debugging Exercise</h2>

        <app-code-viewer [codeToDisplay]="incorrectProgram" [isReadOnly]="true">
        </app-code-viewer>

        <h3 style="margin-top: 1%;">Explanation of errors:</h3>
        <ol>
            @for (explanation of errorExplanations; track $index) {
                <li>{{explanation}}</li>
            }
        </ol>

        <div class="copy-pane">
            <button mat-icon-button color="primary" [cdkCopyToClipboard]="incorrectProgram">
                <mat-icon>content_copy</mat-icon>
              </button>
              <p *ngIf="false">Copied to clipboard!</p>
        </div>
    </div>

    <div *ngIf="exerciseGenerated" class="generated-program-pane">
        <h2>Full Response From Model</h2>

        <p>{{fullResponse}}</p>
    </div>
</div>